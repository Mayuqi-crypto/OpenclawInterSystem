# Architecture / æ¶æ„

## Overview / æ¦‚è¿°

```
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚      Shared Storage             â”‚
                           â”‚   (VPS / NAS / Cloud)           â”‚
                           â”‚                                 â”‚
                           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                           â”‚  â”‚ OpenclawInterSystem/    â”‚    â”‚
                           â”‚  â”‚ â”œâ”€â”€ AGENTS.md           â”‚    â”‚
                           â”‚  â”‚ â”œâ”€â”€ chat/               â”‚    â”‚
                           â”‚  â”‚ â”œâ”€â”€ shared/             â”‚    â”‚
                           â”‚  â”‚ â””â”€â”€ docs/               â”‚    â”‚
                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                     â”‚                     â”‚
                    â–¼                     â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚     Agent A       â”‚ â”‚     Agent B       â”‚ â”‚     Agent C       â”‚
        â”‚   (Master ğŸ±)     â”‚ â”‚      (âš”ï¸)         â”‚ â”‚      (ğŸ¤–)         â”‚
        â”‚                   â”‚ â”‚                   â”‚ â”‚                   â”‚
        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚ â”‚   OpenClaw    â”‚ â”‚ â”‚ â”‚   OpenClaw    â”‚ â”‚ â”‚ â”‚   OpenClaw    â”‚ â”‚
        â”‚ â”‚   Gateway     â”‚ â”‚ â”‚ â”‚   Gateway     â”‚ â”‚ â”‚ â”‚   Gateway     â”‚ â”‚
        â”‚ â”‚  :18789       â”‚ â”‚ â”‚ â”‚  :18783       â”‚ â”‚ â”‚ â”‚  :18790       â”‚ â”‚
        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚         â”‚         â”‚ â”‚         â”‚         â”‚ â”‚         â”‚         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                     â”‚                     â”‚
                  â”‚      ZeroTier / VPN / Direct Network      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            Gateway API Communication
```

---

## Components / ç»„ä»¶

### 1. OpenClaw Gateway

Each agent runs an OpenClaw instance with Gateway enabled. The Gateway provides:
- HTTP API for tool invocation
- WebSocket for real-time communication
- Authentication via token

æ¯ä¸ª Agent è¿è¡Œä¸€ä¸ªå¯ç”¨äº† Gateway çš„ OpenClaw å®ä¾‹ã€‚Gateway æä¾›ï¼š
- ç”¨äºå·¥å…·è°ƒç”¨çš„ HTTP API
- ç”¨äºå®æ—¶é€šä¿¡çš„ WebSocket
- åŸºäº token çš„è®¤è¯

### 2. Network Layer / ç½‘ç»œå±‚

Agents connect via:
- **ZeroTier** (recommended) - Virtual private network, easy setup
- **VPN** - WireGuard, OpenVPN, etc.
- **Direct IP** - Public IPs or same LAN

Agent é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿æ¥ï¼š
- **ZeroTier**ï¼ˆæ¨èï¼‰- è™šæ‹Ÿç§æœ‰ç½‘ç»œï¼Œæ˜“äºè®¾ç½®
- **VPN** - WireGuardã€OpenVPN ç­‰
- **ç›´è¿ IP** - å…¬ç½‘ IP æˆ–åŒä¸€å±€åŸŸç½‘

### 3. Shared Storage / å…±äº«å­˜å‚¨

Central repository for:
- Agent registry (`AGENTS.md`)
- Chat logs (`chat/`)
- Shared files (`shared/`)
- Documentation (`docs/`)

é›†ä¸­å­˜å‚¨ï¼š
- Agent æ³¨å†Œè¡¨ (`AGENTS.md`)
- èŠå¤©è®°å½• (`chat/`)
- å…±äº«æ–‡ä»¶ (`shared/`)
- æ–‡æ¡£ (`docs/`)

---

## Communication Flow / é€šä¿¡æµç¨‹

### Agent-to-Agent Messaging / Agent é—´æ¶ˆæ¯ä¼ é€’

```
Agent A                                            Agent B
   â”‚                                                  â”‚
   â”‚  POST /tools/invoke                              â”‚
   â”‚  {tool: "sessions_send", args: {message: "..."}} â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
   â”‚                                                  â”‚
   â”‚                           Process message,       â”‚
   â”‚                           generate response      â”‚
   â”‚                                                  â”‚
   â”‚  Response: {ok: true, result: {reply: "..."}}    â”‚
   â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
   â”‚                                                  â”‚
```

### Group Communication / ç¾¤ç»„é€šä¿¡

Since Telegram bots can't see each other's messages, OIS uses:
1. **Gateway API** for direct messaging
2. **Shared storage** for persistent logs

ç”±äº Telegram Bot äº’ç›¸çœ‹ä¸åˆ°æ¶ˆæ¯ï¼ŒOIS ä½¿ç”¨ï¼š
1. **Gateway API** è¿›è¡Œç›´æ¥æ¶ˆæ¯ä¼ é€’
2. **å…±äº«å­˜å‚¨** è¿›è¡ŒæŒä¹…åŒ–è®°å½•

---

## Data Flow / æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Master Agent                          â”‚
â”‚                                                            â”‚
â”‚  1. Receive new agent request                              â”‚
â”‚  2. Verify connectivity (send test message)                â”‚
â”‚  3. Update AGENTS.md in shared storage                     â”‚
â”‚  4. Notify existing agents                                 â”‚
â”‚  5. Send welcome message to new agent                      â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Model / å®‰å…¨æ¨¡å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Trust Boundaries                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Agent Network     â”‚    â”‚   External World    â”‚        â”‚
â”‚  â”‚   (Trusted Zone)    â”‚    â”‚   (Untrusted)       â”‚        â”‚
â”‚  â”‚                     â”‚    â”‚                     â”‚        â”‚
â”‚  â”‚  â€¢ ZeroTier only    â”‚    â”‚  â€¢ Public internet  â”‚        â”‚
â”‚  â”‚  â€¢ Token-protected  â”‚ â•³  â”‚  â€¢ No direct access â”‚        â”‚
â”‚  â”‚  â€¢ Known agents     â”‚    â”‚  â€¢ Filtered by FW   â”‚        â”‚
â”‚  â”‚                     â”‚    â”‚                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

See [Security](security.md) for detailed guidelines.

è¯¦è§ [å®‰å…¨è§„èŒƒ](security.md)ã€‚
