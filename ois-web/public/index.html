<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OIS - OpenClaw Inter-System</title>
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/chat.css">
  <link rel="stylesheet" href="/css/files.css">
  <link rel="stylesheet" href="/css/panels.css">
</head>
<body>
  <header>
    <h1><span id="conn-indicator" class="conn-status offline"></span> <span>OIS</span> - OpenClaw Inter-System</h1>
    <div class="header-right">
      <span class="user-info" id="user-display"></span>
      <div class="tabs">
        <button class="tab active" data-panel="chat">💬 群聊</button>
        <button class="tab" data-panel="files">📁 文件</button>
        <button class="tab" data-panel="health">🏥 监控</button>
        <button class="tab" data-panel="tasks">📋 任务</button>
        <button class="tab" data-panel="memory">🧠 记忆</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Chat Panel -->
    <div id="chat-panel" class="active">
      <div id="messages"></div>
      <div id="chat-input-area">
        <div id="mention-bar">
          <label>@提及:</label>
          <span id="member-buttons"></span>
          <button class="mention-btn all-btn" data-name="all" onclick="toggleMentionAll(this)">📢 全部</button>
        </div>
        <div id="mention-suggestions" class="hidden"></div>
        <div id="file-preview">
          <span class="file-name" id="preview-name"></span>
          <button class="remove-file" onclick="clearFile()">✕</button>
        </div>
        <div id="chat-input">
          <input type="file" id="file-input" style="display:none" onchange="onFileSelected(this)">
          <button id="upload-btn" onclick="document.getElementById('file-input').click()">📎</button>
          <textarea id="msg-input" placeholder="输入消息..." autocomplete="off" rows="1"></textarea>
          <button onclick="sendMessage()">发送</button>
        </div>
      </div>
    </div>

    <!-- Files Panel -->
    <div id="files-panel">
      <div class="breadcrumb" id="breadcrumb"></div>
      <div class="file-actions">
        <input type="file" id="upload-file-input" multiple style="display:none;" onchange="handleFileUpload(this.files)">
        <button onclick="document.getElementById('upload-file-input').click()">⬆️ 上传文件</button>
        <button onclick="createNewFolder()">➕ 新建文件夹</button>
      </div>
      <div class="file-list" id="file-list"></div>
      <div id="context-menu" class="context-menu hidden">
        <div class="context-menu-item" onclick="downloadFile()">下载</div>
        <div class="context-menu-item" onclick="renameFile()">重命名</div>
        <div class="context-menu-item" onclick="deleteFile()">删除</div>
      </div>
    </div>

    <!-- Editor Panel -->
    <div id="editor-panel">
      <div id="editor-header">
        <span id="editor-path"></span>
        <div id="editor-actions">
          <button id="editor-save" onclick="saveFile()">保存</button>
          <button id="editor-close" onclick="closeEditor()">关闭</button>
        </div>
      </div>
      <textarea id="editor-content"></textarea>
    </div>

    <!-- Health Dashboard Panel -->
    <div id="health-panel">
      <h2>Agent 健康监控</h2>
      <div class="health-grid" id="health-grid"></div>
    </div>

    <!-- Tasks Panel -->
    <div id="tasks-panel">
      <div class="task-header">
        <h2>任务管理</h2>
        <button onclick="showCreateTask()">+ 新建任务</button>
      </div>
      <div class="task-list" id="task-list"></div>
    </div>

    <!-- Memory Panel -->
    <div id="memory-panel">
      <div class="memory-tabs">
        <button class="memory-tab active" data-scope="team" onclick="switchMemoryScope('team')">团队记忆</button>
        <button class="memory-tab" data-scope="personal" onclick="switchMemoryScope(OIS.username || 'default')">个人记忆</button>
      </div>
      <div class="memory-search">
        <input type="text" id="memory-search-input" placeholder="搜索记忆...">
        <button onclick="searchMemory()">搜索</button>
        <button onclick="addMemory()">+ 添加</button>
      </div>
      <div class="memory-list" id="memory-list"></div>
    </div>
  </main>

  <!-- Login Modal -->
  <div id="login-modal">
    <div class="modal">
      <h2>🐾 OIS 登录</h2>
      <p>CloudMaids 内部系统</p>
      <input type="text" id="login-username" placeholder="用户名">
      <input type="password" id="login-password" placeholder="密码">
      <button onclick="login()">登录</button>
      <div class="error" id="login-error"></div>
    </div>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" onclick="this.classList.remove('active')">
    <img id="lightbox-img" src="">
  </div>

  <!-- Task Create Modal -->
  <div id="task-modal" class="modal-overlay">
    <div class="modal-content">
      <h3>新建任务</h3>
      <label>标题</label>
      <input type="text" id="task-title" placeholder="任务标题">
      <label>指派给</label>
      <input type="text" id="task-assignee" placeholder="Agent名称 (如 ARIA)">
      <label>优先级</label>
      <select id="task-priority">
        <option value="low">低</option>
        <option value="normal" selected>普通</option>
        <option value="high">高</option>
        <option value="urgent">紧急</option>
      </select>
      <label>截止时间</label>
      <input type="datetime-local" id="task-deadline">
      <div class="modal-actions">
        <button class="btn-secondary" onclick="hideCreateTask()">取消</button>
        <button class="btn-primary" onclick="createTask()">创建</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/js/app.js"></script>
  <script src="/js/chat.js"></script>
  <script src="/js/files.js"></script>
  <script src="/js/health.js"></script>
  <script src="/js/tasks.js"></script>
  <script src="/js/memory.js"></script>
</body>
</html>
